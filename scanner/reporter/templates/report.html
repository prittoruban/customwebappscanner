<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerability Scan Report — v2.0</title>
    <style>
        :root {
            --c-bg: #0f1117;
            --c-surface: #1a1d29;
            --c-surface2: #252836;
            --c-border: #2e3246;
            --c-text: #e0e0e0;
            --c-muted: #8b8fa3;
            --c-accent: #6c8aff;
            --c-critical: #ff4d6a;
            --c-high: #ff8c42;
            --c-medium: #ffc84a;
            --c-low: #4da6ff;
            --c-info: #7c7f93;
            --c-green: #4ade80;
            --radius: 10px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--c-bg);
            color: var(--c-text);
            line-height: 1.6;
            padding: 24px;
        }

        .container { max-width: 1280px; margin: 0 auto; }

        /* ── Header ── */
        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--c-border);
            padding-bottom: 20px; margin-bottom: 28px;
        }
        header h1 { font-size: 1.8em; color: #fff; font-weight: 700; }
        header .version { color: var(--c-accent); font-size: .9em; font-weight: 600; }

        /* ── Scan info ── */
        .scan-info {
            background: var(--c-surface); border: 1px solid var(--c-border);
            border-radius: var(--radius); padding: 18px 24px; margin-bottom: 28px;
        }
        .scan-info p { font-size: .92em; margin: 4px 0; color: var(--c-muted); }
        .scan-info strong { color: var(--c-text); }

        /* ── Stat cards ── */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px; margin-bottom: 32px;
        }
        .stat-card {
            background: var(--c-surface); border: 1px solid var(--c-border);
            border-radius: var(--radius); padding: 20px; text-align: center;
        }
        .stat-card .num { font-size: 2.2em; font-weight: 800; display: block; }
        .stat-card .lbl { font-size: .82em; color: var(--c-muted); text-transform: uppercase; letter-spacing: .6px; }
        .stat-card.critical .num { color: var(--c-critical); }
        .stat-card.high .num { color: var(--c-high); }
        .stat-card.medium .num { color: var(--c-medium); }
        .stat-card.low .num { color: var(--c-low); }
        .stat-card.total .num { color: var(--c-accent); }

        /* ── Section titles ── */
        h2 {
            font-size: 1.3em; color: #fff; margin: 32px 0 16px;
            border-bottom: 1px solid var(--c-border); padding-bottom: 10px;
        }

        /* ── Table ── */
        .findings-table {
            width: 100%; border-collapse: collapse; margin-bottom: 32px;
            font-size: .88em;
        }
        .findings-table th {
            background: var(--c-surface2); color: var(--c-muted);
            padding: 12px 14px; text-align: left; font-weight: 600;
            text-transform: uppercase; font-size: .78em; letter-spacing: .5px;
            border-bottom: 1px solid var(--c-border);
        }
        .findings-table td {
            padding: 10px 14px; border-bottom: 1px solid var(--c-border);
            vertical-align: top;
        }
        .findings-table tr:hover td { background: rgba(108,138,255,.04); }

        /* Badges */
        .badge {
            display: inline-block; padding: 3px 10px; border-radius: 12px;
            font-size: .78em; font-weight: 700; text-transform: uppercase;
        }
        .badge-critical { background: rgba(255,77,106,.15); color: var(--c-critical); }
        .badge-high { background: rgba(255,140,66,.15); color: var(--c-high); }
        .badge-medium { background: rgba(255,200,74,.15); color: var(--c-medium); }
        .badge-low { background: rgba(77,166,255,.15); color: var(--c-low); }
        .badge-info { background: rgba(124,127,147,.15); color: var(--c-info); }

        .mono {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            background: var(--c-surface2); padding: 2px 6px; border-radius: 4px;
            font-size: .85em; word-break: break-all;
        }
        .url-cell { color: var(--c-muted); word-break: break-all; font-size: .85em; }
        .cwe-cell { color: var(--c-accent); font-size: .82em; }
        .conf-cell { font-size: .82em; color: var(--c-muted); }

        /* ── Chains ── */
        .chain-card {
            background: var(--c-surface); border: 1px solid var(--c-border);
            border-left: 3px solid var(--c-critical); border-radius: var(--radius);
            padding: 16px 20px; margin-bottom: 14px;
        }
        .chain-card h4 { font-size: .95em; color: #fff; margin-bottom: 6px; }
        .chain-card p { font-size: .85em; color: var(--c-muted); }

        /* ── Remediation ── */
        .remediation-block {
            background: var(--c-surface); border: 1px solid var(--c-border);
            border-radius: var(--radius); padding: 16px 20px; margin-bottom: 14px;
        }
        .remediation-block h4 { font-size: .9em; color: var(--c-green); margin-bottom: 8px; }
        .remediation-block pre {
            background: var(--c-bg); border: 1px solid var(--c-border);
            border-radius: 6px; padding: 14px; overflow-x: auto;
            font-size: .82em; line-height: 1.5; color: var(--c-text);
        }

        /* ── No findings ── */
        .no-findings {
            text-align: center; padding: 48px; color: var(--c-green);
            font-size: 1.15em;
        }

        /* ── Footer ── */
        footer {
            margin-top: 40px; padding-top: 16px;
            border-top: 1px solid var(--c-border);
            text-align: center; color: var(--c-muted); font-size: .82em;
        }

        /* ── Summary ── */
        .summary-section {
            background: var(--c-surface); border: 1px solid var(--c-border);
            border-radius: var(--radius); padding: 18px 24px; margin-bottom: 28px;
        }
        .summary-section h3 { color: #fff; margin-bottom: 12px; font-size: 1em; }
        .summary-list { list-style: none; padding: 0; }
        .summary-list li {
            padding: 6px 0; border-bottom: 1px solid var(--c-border);
            font-size: .9em;
        }
        .summary-list li:last-child { border-bottom: none; }

        @media print {
            body { background: #fff; color: #333; }
            .stat-card, .scan-info, .chain-card, .remediation-block,
            .summary-section { border: 1px solid #ddd; background: #fafafa; }
            .stat-card .num { color: inherit; }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- HEADER -->
    <header>
        <h1>Web Application Vulnerability Scan Report</h1>
        <span class="version">Scanner v{{ scanner_version }}</span>
    </header>

    <!-- SCAN INFO -->
    <div class="scan-info">
        <p><strong>Target URL:</strong> {{ target_url }}</p>
        <p><strong>Scan Date:</strong> {{ scan_date }}</p>
        <p><strong>Total Findings:</strong> {{ total_findings }}</p>
    </div>

    {% if statistics.total_vulnerabilities > 0 %}

    <!-- STATS -->
    <div class="stats-grid">
        <div class="stat-card total">
            <span class="num">{{ statistics.total_vulnerabilities }}</span>
            <span class="lbl">Total</span>
        </div>
        {% if statistics.by_severity.CRITICAL %}
        <div class="stat-card critical">
            <span class="num">{{ statistics.by_severity.CRITICAL }}</span>
            <span class="lbl">Critical</span>
        </div>
        {% endif %}
        {% if statistics.by_severity.HIGH %}
        <div class="stat-card high">
            <span class="num">{{ statistics.by_severity.HIGH }}</span>
            <span class="lbl">High</span>
        </div>
        {% endif %}
        {% if statistics.by_severity.MEDIUM %}
        <div class="stat-card medium">
            <span class="num">{{ statistics.by_severity.MEDIUM }}</span>
            <span class="lbl">Medium</span>
        </div>
        {% endif %}
        {% if statistics.by_severity.LOW %}
        <div class="stat-card low">
            <span class="num">{{ statistics.by_severity.LOW }}</span>
            <span class="lbl">Low</span>
        </div>
        {% endif %}
        <div class="stat-card">
            <span class="num">{{ statistics.unique_urls }}</span>
            <span class="lbl">URLs</span>
        </div>
        <div class="stat-card">
            <span class="num">{{ statistics.risk_score }}</span>
            <span class="lbl">Risk Score</span>
        </div>
        <div class="stat-card">
            <span class="num">{{ statistics.chains }}</span>
            <span class="lbl">Chains</span>
        </div>
    </div>

    <!-- BY TYPE -->
    <div class="summary-section">
        <h3>Vulnerabilities by Type</h3>
        <ul class="summary-list">
            {% for vuln_type, count in statistics.by_type.items() %}
            <li><strong>{{ vuln_type }}:</strong> {{ count }} finding(s)</li>
            {% endfor %}
        </ul>
    </div>

    <!-- FINDINGS TABLE -->
    <h2>Detailed Findings</h2>
    <table class="findings-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Severity</th>
                <th>Type</th>
                <th>URL</th>
                <th>Parameter</th>
                <th>Payload</th>
                <th>CWE / OWASP</th>
                <th>Confidence</th>
            </tr>
        </thead>
        <tbody>
            {% for finding in findings %}
            <tr>
                <td>{{ loop.index }}</td>
                <td><span class="badge badge-{{ finding.severity|lower }}">{{ finding.severity }}</span></td>
                <td><strong>{{ finding.vuln_type }}</strong></td>
                <td class="url-cell">{{ finding.url }}</td>
                <td>{{ finding.parameter }}</td>
                <td><span class="mono" title="{{ finding.payload }}">{{ finding.payload[:90] }}{% if finding.payload|length > 90 %}…{% endif %}</span></td>
                <td class="cwe-cell">
                    {% if finding.cwe_id %}CWE-{{ finding.cwe_id }}{% endif %}
                    {% if finding.owasp_category %}<br>{{ finding.owasp_category }}{% endif %}
                </td>
                <td class="conf-cell">{{ finding.confidence or '' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- CHAINS -->
    {% if chains %}
    <h2>Vulnerability Chains</h2>
    <p style="color:var(--c-muted);font-size:.88em;margin-bottom:14px;">
        Compound attack paths where multiple vulnerabilities combine for higher impact.
    </p>
    {% for chain in chains %}
    <div class="chain-card">
        <h4>
            <span class="badge badge-{{ chain.severity|lower }}">{{ chain.severity }}</span>
            {{ chain.id }}
        </h4>
        <p>Types: {{ chain.types | join(', ') }} &mdash; {{ chain.count }} linked finding(s)</p>
    </div>
    {% endfor %}
    {% endif %}

    <!-- REMEDIATION -->
    {% set remediated_findings = [] %}
    {% for f in findings %}
        {% if f.remediation %}
            {% if remediated_findings.append(f) %}{% endif %}
        {% endif %}
    {% endfor %}
    {% if remediated_findings %}
    <h2>Remediation Guidance</h2>
    <p style="color:var(--c-muted);font-size:.88em;margin-bottom:14px;">
        Auto-generated code fixes for detected vulnerabilities.
    </p>
    {% for f in remediated_findings[:10] %}
    <div class="remediation-block">
        <h4>{{ f.vuln_type }} — {{ f.parameter }} ({{ f.url }})</h4>
        <pre>{{ f.remediation }}</pre>
    </div>
    {% endfor %}
    {% if remediated_findings|length > 10 %}
    <p style="color:var(--c-muted);font-size:.85em;">… and {{ remediated_findings|length - 10 }} more remediation(s). See JSON report for full details.</p>
    {% endif %}
    {% endif %}

    {% else %}
    <!-- NO FINDINGS -->
    <div class="no-findings">
        <p style="font-size:2em;margin-bottom:12px;">&#10003;</p>
        <p><strong>No vulnerabilities found!</strong></p>
        <p style="color:var(--c-muted);">The target appears secure against the tested attack vectors.</p>
    </div>
    {% endif %}

    <footer>
        <p>Generated by <strong>Web Application Vulnerability Scanner v{{ scanner_version }}</strong></p>
        <p>For educational and authorized testing purposes only.</p>
    </footer>

</div>
</body>
</html>
